<!DOCTYPE html>
<!-- saved from url=(0037)http://localhost/jdr/charsheet/Davlan -->
<html lang="fr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" type="image/png" href="http://localhost/jdr/assets/images/favicon.png"><style></style>

    <link rel="stylesheet" type="text/css" href="./Davlan - JdR_files/bootstrap.min.css" media="screen">
<link rel="stylesheet" type="text/css" href="./Davlan - JdR_files/font-awesome.min.css" media="screen">
<link rel="stylesheet" type="text/css" href="./Davlan - JdR_files/datatables.min.css" media="screen">
<link rel="stylesheet" type="text/css" href="./Davlan - JdR_files/style.css" media="screen">
<script type="text/javascript" src="./Davlan - JdR_files/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="./Davlan - JdR_files/bootstrap.min.js"></script>
<script type="text/javascript" src="./Davlan - JdR_files/datatables.min.js"></script>
<script type="text/javascript" src="./Davlan - JdR_files/main.js"></script>
<script type="text/javascript" src="./Davlan - JdR_files/register.js"></script>
    
    <title>Davlan - JdR</title>
  </head><style type="text/css" id="stylish_s_empty"></style><body style="background: none !important;">
<nav class="navbar navbar-inverse navbar-fixed-top">

  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="http://localhost/jdr/charsheet/Davlan#">JdR</a>
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav" id="menu">
        <li class="dropdown show-on-hover">
          <a class="dropdown-toggle" data-toggle="dropdown" role="button"><i class="fa fa-user-circle"></i> Vue joueur <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu">
                        <li><a href="http://localhost/jdr/charsheet/Davlan"><i class="fa fa-caret-right"></i> Davlan</a></li>
                        <li><a href="http://localhost/jdr/charsheet/Nightz"><i class="fa fa-caret-right"></i> Nightz</a></li>
                        <li><a href="http://localhost/jdr/charsheet/Halsthra"><i class="fa fa-caret-right"></i> Halsthra</a></li>
                      </ul>
        </li>
        <li><a href="http://localhost/jdr/master"><i class="fa fa-user-circle-o"></i> Vue MJ</a></li>
      </ul>
    </div>
  </div>
</nav>
<div class="container-fluid" style="padding-top: 80px;">
  
<script type="text/javascript">
  global = {"char_id":"1","name":"Davlan","class":"Paladin","race":"Humain","level":"1","traits":"Altruiste, bon, droit","strength":"65","dexterity":"50","luck":"20","constitution":"65","charisma":"50","perception":"20","education":"50","fight_melee":"65","fight_bare":"50","fight_distance":"20","hp_cur":"113","hp_max":"113","pp_cur":"20","pp_max":"20","gold":"19","comment":""};
  console.log(global);
</script>

<div class="row">

  <div class="col-lg-6 col-lg-offset-3">
    <div class="row">
      <div class="col-md-6">
        <div class="panel panel-primary" style="min-height: 194px;">
          <div class="panel-heading">
            <button class="btn btn-xs btn-info pull-right" style="margin-top: -3px; margin-right: -3px;"><i class="fa fa-floppy-o"></i></button>
            <h4 class="panel-title">Personnage</h4>
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-sm-4"><label class="char">Nom</label><input type="text" id="name" class="input-underline char_val"></div>
              <div class="col-sm-4"><label class="char">Race</label><input type="text" id="race" class="input-underline char_val"></div>
              <div class="col-sm-4"><label class="char">Classe</label><input type="text" id="class" class="input-underline char_val"></div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-12"><label>Réputations :    </label><input type="text" id="traits" class="input-underline char_val" style="width: 100%; margin: 0;"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="panel panel-primary">
          <div class="panel-heading">
            <span class="pull-right">( <img src="./Davlan - JdR_files/enter_key.png" class="img-responsive" style="height: 20px; display: inline"> pour enregistrer )</span>
            <h4 class="panel-title">Caractéristiques</h4>
          </div>
          <div class="panel-body">

            <div class="row">

              <div class="col-xs-4">
                <div class="col-xs-6 text-left" style="font-weight: bold; font-size: 14px; padding: 5px;">FORC</div>
                <div class="col-xs-6 text-right text-info" style="font-weight: bold; font-size: 14px; padding: 5px;" id="c_str_1">
                  <input type="text" class="input-underline text-center carac char_val" value="65%" style="width: 100%; text-align: center !important;" id="strength">
                </div>
              </div>

              <div class="col-xs-4"></div>

              <div class="col-xs-4">
                <div class="col-xs-6 text-left" style="font-weight: bold; font-size: 14px; padding: 5px;">CONS</div>
                <div class="col-xs-6 text-right text-info" style="font-weight: bold; font-size: 14px; padding: 5px;" id="c_con_1">
                  <input type="text" class="input-underline text-center carac char_val" value="65%" style="width: 100%; text-align: center !important;" id="constitution">
                </div>
              </div>

            </div>

            <div class="row">

              <div class="col-xs-4">
                <div class="col-xs-6 text-left" style="font-weight: bold; font-size: 14px; padding: 5px;">DEXT</div>
                <div class="col-xs-6 text-right text-info" style="font-weight: bold; font-size: 14px; padding: 5px;" id="c_dex_1">
                  <input type="text" class="input-underline text-center carac char_val" value="50%" style="width: 100%; text-align: center !important;" id="dexterity">
                </div>
              </div>

              <div class="col-xs-4">
                <div class="col-xs-6 text-left" style="font-weight: bold; font-size: 14px; padding: 5px;">EDUC</div>
                <div class="col-xs-6 text-right text-info" style="font-weight: bold; font-size: 14px; padding: 5px;" id="c_edu_1">
                  <input type="text" class="input-underline text-center carac char_val" value="50%" style="width: 100%; text-align: center !important;" id="education">
                </div>
              </div>

              <div class="col-xs-4">
                <div class="col-xs-6 text-left" style="font-weight: bold; font-size: 14px; padding: 5px;">CHAR</div>
                <div class="col-xs-6 text-right text-info" style="font-weight: bold; font-size: 14px; padding: 5px;" id="c_cha_1">
                  <input type="text" class="input-underline text-center carac char_val" value="50%" style="width: 100%; text-align: center !important;" id="charisma">
                </div>
              </div>

            </div>

            <div class="row">

              <div class="col-xs-4">
                <div class="col-xs-6 text-left" style="font-weight: bold; font-size: 14px; padding: 5px;">CHAN</div>
                <div class="col-xs-6 text-right text-info" style="font-weight: bold; font-size: 14px; padding: 5px;" id="c_luk_1">
                  <input type="text" class="input-underline text-center carac char_val" value="20%" style="width: 100%; text-align: center !important;" id="luck">
                </div>
              </div>

              <div class="col-xs-4"></div>

              <div class="col-xs-4">
                <div class="col-xs-6 text-left" style="font-weight: bold; font-size: 14px; padding: 5px;">PERC</div>
                <div class="col-xs-6 text-right text-info" style="font-weight: bold; font-size: 14px; padding: 5px;" id="c_per_1">
                  <input type="text" class="input-underline text-center carac char_val" value="20%" style="width: 100%; text-align: center !important;" id="perception">
                </div>
              </div>

            </div>

            <div class="row">

              <div class="col-xs-4"></div>

              <div class="col-xs-4">
                <div class="col-xs-12 text-right text-info" style="font-weight: bold; font-size: 14px; padding: 5px;" id="c_gld_1">
                  <input type="text" class="input-underline text-center carac char_val" value="19" style="width: 65%; text-align: center !important;" id="gold"> <span style="color: black;">PO</span>
                </div>
              </div>

              <div class="col-xs-4"></div>

            </div>

          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-primary">
          <div class="panel-heading">
            <h4 class="panel-title">Dons de Davlan</h4>
          </div>
          <div class="panel-body">
            <div id="skill_table_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer"><div class="row"><div class="col-sm-6"></div><div class="col-sm-6"></div></div><div class="row"><div class="col-sm-12"><table class="table table-striped table-hover table-condensed dataTable no-footer" id="skill_table" cellspacing="0" width="100%" role="grid" style="width: 100%;">
              <thead>
                <tr role="row"><th class="sorting_asc" tabindex="0" aria-controls="skill_table" rowspan="1" colspan="1" style="width: 308px;" aria-label="Don: activate to sort column descending" aria-sort="ascending">Don</th><th class="sorting" tabindex="0" aria-controls="skill_table" rowspan="1" colspan="1" style="width: 86px;" aria-label="Coût: activate to sort column ascending">Coût</th><th class="sorting" tabindex="0" aria-controls="skill_table" rowspan="1" colspan="1" style="width: 662px;" aria-label="Effet: activate to sort column ascending">Effet</th></tr>
              </thead>
            <tbody><tr role="row" class="odd"><td class="sorting_1">Blocage</td><td>1 PP</td><td>10% de chances de bloquer (contre attaque si critique)</td></tr><tr role="row" class="even"><td class="sorting_1">Bénédiction de puissance</td><td>1 PP</td><td>Renforce les attaques (3 tours)</td></tr><tr role="row" class="odd"><td class="sorting_1">Soins légers</td><td>X PP</td><td>Soigne X HP</td></tr></tbody></table></div></div><div class="row"><div class="col-sm-5"></div><div class="col-sm-7"></div></div></div>
          </div>
        </div>
      </div>
    </div>
  </div>  
</div>

<script type="text/javascript">

  $(window).keypress(function(event) {
    if (!(event.which == 115 && event.ctrlKey) && !(event.which == 19)) return true;
    alert("Ctrl-S pressed");
    event.preventDefault();
    return false;
  });

  $(document).ready(function () {
    $('.char_val').keyup(function (k) {
      if (k.keyCode == 13) {
        var input = $(this);
        save_char_carac(input);
      }
    });

    $('.carac').keydown(function () {
      var field = $(this);
      var oldval   = field.val();

      setTimeout( function () {
        var true_val = field.val().substring(0, field.val().length - 1);

        if(field.val().slice(-1) != '%' || isNaN(true_val) || parseInt(true_val) < 0 || parseInt(true_val) > 100) {
          field.val(oldval);
          field[0].setSelectionRange(oldval.length-1, oldval.length-1);
        }
      }, 1);
    });

    var tbl_height = $(window).height() - 210;

    console.log("Height : " + tbl_height);

    if( $.fn.DataTable.isDataTable('#skill_table') ) {
      $('#skill_table').dataTable().fnDestroy();
    }
    $("#skill_table").DataTable({
      ajax:           "http://localhost/jdr/Ajax/getCharSkill/1",
      info:           false,
      filter:         false,
      paging:         false,
      scroller:       false,
      scrollCollapse: false,
      columns: [
        {data: "name"},
        {data: "worth"},
        {data: "effect"}
      ]
    });

    $.each(global, function (index, value) {
      console.log("Index : " + index);
      console.log("Value : " + value);
      $('#'+index).val(value);
    });

    $('.carac').each(function (index) {
      if($(this).attr('id') != "gold") {
        $(this).val($(this).val() + '%')
      }
    });

  });

  function change_comp (id, sign) {
    console.log(sign + "5 on " + id);
    var field = $('#comp_val_'+id);
    var newval;

    if(sign == "+") {
      newval = parseInt(field.html()) + 5;
    }
    else {
      newval = parseInt(field.html()) - 5;
    }

    var send_sign = sign == "+" ? "plus" : "minus";

    $.post('http://localhost/jdr/Ajax/changeCompVal/' + global.char_id + '/' + id + '/' + send_sign);

    field.html(newval);
  }

  function save_char_carac (input) {
  var old_bg = input.css('background-color');

  $.ajax({
    data: {
      column: input.attr('id'),
      value:  input.val().replace('%','')
    },
    type: "POST",
    async: false,
    url: 'http://localhost/jdr/Ajax/updateChar',
    success: function(data){
      input.css('background-color',"lightgreen");
      setTimeout( function () {
        input.css('background-color', old_bg);
      }, 500);
      input.blur();
    },
    error: function(e, d, l){
      console.log(e);
    }
  });
}
</script>      </div>
    
  
</body></html>